# System setup {#sec-setup}

```{r, echo = FALSE}
source("common.R")
```

## Prepare your system {#setup-prep}

To get started, make sure you have the latest version of R (at least `r paste0(version$major, ".", version$minor)`, which is the version being used to render this book), then run the following code to get the packages you'll need:

```{r, eval = FALSE}
install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
```

Make sure you have a recent version of the RStudio integrated development environment (IDE).
New versions are released regularly, so we recommend updating often to get access to the latest and greatest features.

Download the current version of RStudio Desktop here: <https://posit.co/download/rstudio-desktop/>.
Most readers can use the free, open source version of RStudio Desktop.

## devtools, usethis, and you {#sec-setup-usage}

> "I am large, I contain multitudes."
>
> --- Walt Whitman, Song of Myself

As mentioned in @sec-intro-phil, devtools is a 'meta-package', encompassing and exposing functionality maintained in seven smaller packages[^setup-1].
For example, devtools might provide a wrapper function in order to set user-friendly defaults, introduce helpful interactive behaviour, or to combine functionality from multiple sub-packages.
In some cases it simply re-exports a function from another package to make it easily available when devtools is loaded.

[^setup-1]: [remotes](https://remotes.r-lib.org/), [pkgbuild](https://github.com/r-lib/pkgbuild), [pkgload](https://github.com/r-lib/pkgload), [rcmdcheck](https://github.com/r-lib/rcmdcheck), [revdepcheck](https://github.com/r-lib/revdepcheck), [sessioninfo](https://github.com/r-lib/sessioninfo), [usethis](https://usethis.r-lib.org/)

What's our recommended approach to devtools and its constituent packages?
It varies, depending on your intentions when using the functions:

-   If you are using the functions interactively to help you develop your package, you should think of devtools as the provider of your favorite functions for package development. In this case you should attach devtools and call the functions without qualification (e.g., `load_all()`).
-   If you are using functions from devtools and friends within the package code you are writing, you should NOT depend on devtools, but should instead access functions via the package that is their primary home.
    -   devtools should rarely appear in the role of `pkg` in a qualified call of the form `pkg::fcn()`. Instead, `pkg` should be the package where `fcn()` is defined. For example, if you are creating a function in your package in which you need to query the state of the user's R session, use `sessioninfo::session_info()` in your package instead of `devtools::session_info()`.
-   If you find bugs, try to report them on the package that is a function's primary home. The help for `devtools::fcn()` usually states when devtools is re-exporting a function from another package.

The usethis package is the one constituent package that more people may be aware of and that they may use directly.
It holds the functions that act on the files and folders in an R project, most especially for any project that is also an R package.
devtools makes it easy to access usethis functions interactively, as when when you call `library(devtools)`, usethis is also attached.
Then you can use any function in usethis without qualification, e.g., just call `use_testthat()`.
If you choose to specify the namespace, such as when working in a more programmatic style, then make sure you qualify the call with usethis, e.g., `usethis::use_testthat()`.

### Personal startup configuration

You can attach devtools like so:

```{r, eval = FALSE}
library(devtools)
```

But it soon grows aggravating to repeatedly attach devtools in every R session.
Therefore, we strongly recommend attaching devtools in your `.Rprofile` startup file, like so:

```{r eval = FALSE}
if (interactive()) {
  suppressMessages(require(devtools))
}
```

For convenience, the function `use_devtools()` creates `.Rprofile`, if needed, opens it for editing, and puts the necessary lines of code on the clipboard and the screen.
Another package you may want to handle this way is testthat.

::: callout-warning
In general, it's a bad idea to attach packages in `.Rprofile`, as it invites you to create R scripts that don't reflect all of their dependencies via explicit calls to `library(foo)`.
But devtools is a workflow package that smooths the process of package development and is, therefore, unlikely to get baked into any analysis scripts.
Note how we still take care to only attach in interactive sessions.
:::

usethis consults certain options when, for example, creating R packages *de novo*.
This allows you to specify personal defaults for yourself as a package maintainer or for your preferred license.
Here's an example of a code snippet that could go in `.Rprofile`:

```{r, eval = FALSE}
options(
  usethis.full_name = "Jane Doe",
  usethis.description = list(
    `Authors@R` = 'person("Jane", "Doe", email = "jane@example.com", role = c("aut", "cre"), 
    comment = c(ORCID = "YOUR-ORCID-ID"))',
    License = "MIT + file LICENSE",
    Version = "0.0.0.9000"
  )
)
```

The following code installs the development versions of devtools and usethis, which may be important during the revision of the book.

```{r, eval = FALSE}
devtools::install_github("r-lib/devtools")
devtools::install_github("r-lib/usethis")
```

### Verify system prep

You can request a "(package) development situation report" with `devtools::dev_sitrep()`:

```{r, eval = FALSE}
devtools::dev_sitrep()
#> ── R ───────────────────────────────────────────────────────────────────────
#> • version: 4.1.2
#> • path: '/Library/Frameworks/R.framework/Versions/4.1/Resources/'
#> ── RStudio ─────────────────────────────────────────────────────────────────
#> • version: 2022.2.0.443
#> ── devtools ────────────────────────────────────────────────────────────────
#> • version: 2.4.3.9000
#> • devtools or its dependencies out of date:
#>   'gitcreds', 'gh'
#>   Update them with `devtools::update_packages("devtools")`
#> ── dev package ─────────────────────────────────────────────────────────────
#> • package: 'rpkgs'
#> • path: '/Users/jenny/rrr/r-pkgs/'
#> • rpkgs dependencies out of date:
#>   'gitcreds', 'generics', 'tidyselect', 'dplyr', 'tidyr', 'broom', 'gh'
#>  Update them with `devtools::install_dev_deps()`
```

If this reveals that certain tools or packages are missing or out-of-date, you are encouraged to update them.
